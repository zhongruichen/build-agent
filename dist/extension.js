"use strict";var f=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var O=f((us,ve)=>{"use strict";var ye=require("vscode");function ht(){return ye.workspace.getConfiguration("multiAgent").get("models",[])}function yt(){return ye.workspace.getConfiguration("multiAgent").get("roles",[])}function be(r){return yt().find(t=>t.name.toLowerCase()===r.toLowerCase())}function Se(r){let e=ht();if(e.length===0)return null;let t=be(r);if(!t||!t.model)return JSON.parse(JSON.stringify(e[0]));let s=e.find(n=>n.name===t.model);return JSON.parse(JSON.stringify(s||e[0]))}function bt(r="Evaluator"){let e=Se(r);return e?[e]:[]}ve.exports={getModelForRole:Se,getModelsForTeam:bt,getRoleProfile:be}});var _=f((ls,$e)=>{"use strict";var St=require("vscode"),P;function vt(){P||(P=St.window.createOutputChannel("\u591A\u667A\u80FD\u4F53\u65E5\u5FD7"))}function $t(r){P&&P.append(String(r))}function kt(r){P&&P.appendLine(String(r))}function Pt(){P&&P.show(!0)}function Tt(){P&&(P.dispose(),P=void 0)}$e.exports={createLogChannel:vt,log:$t,logLine:kt,show:Pt,dispose:Tt}});var Y=f((ds,Ee)=>{"use strict";var D=require("fs").promises,Te=require("path"),ke=require("vscode"),Pe=ke.workspace.workspaceFolders?ke.workspace.workspaceFolders[0].uri.fsPath:".";function K(r){let e=Te.resolve(Pe,r);if(!e.startsWith(Pe))throw new Error("Error: Path is outside of the workspace directory. Access denied.");return e}async function xt(r,e){try{let t=K(r);return await D.mkdir(Te.dirname(t),{recursive:!0}),await D.writeFile(t,e,"utf8"),`File "${r}" has been written successfully.`}catch(t){return`Error writing file: ${t.message}`}}async function xe(r){try{let e=K(r);return await D.readFile(e,"utf8")}catch(e){return`Error reading file: ${e.message}`}}async function Et(r="./"){try{let e=K(r),s=(await D.readdir(e,{withFileTypes:!0})).map(n=>n.isDirectory()?`${n.name}/`:n.name).join(`
`);return`Listing for "${r}":
${s}`}catch(e){return`Error listing files: ${e.message}`}}async function qt(r,e){try{let t=await xe(r);if(t.startsWith("Error reading file:"))throw new Error(t);let s=await e.executeTask(t);return`Summary of "${r}":
${s}`}catch(t){return`Error summarizing file: ${t.message}`}}Ee.exports={writeFile:xt,readFile:xe,listFiles:Et,summarizeFile:qt}});var Re=f((ps,Ae)=>{"use strict";var{exec:At}=require("child_process"),qe=require("vscode"),Rt=require("util"),Ft=Rt.promisify(At),Mt=qe.workspace.workspaceFolders?qe.workspace.workspaceFolders[0].uri.fsPath:".";async function Ot(r){if(["rm -rf","sudo","mv",":",">"].some(t=>r.includes(t)))return`Error: Command "${r}" is not allowed for security reasons.`;try{let{stdout:t,stderr:s}=await Ft(r,{cwd:Mt}),n="";return t&&(n+=`STDOUT:
${t}
`),s&&(n+=`STDERR:
${s}
`),n.trim()||"Command executed successfully with no output."}catch(t){return`Error executing command: ${t.message}
STDOUT:
${t.stdout}
STDERR:
${t.stderr}`}}Ae.exports={executeCommand:Ot}});var Me=f((gs,Fe)=>{"use strict";async function It(r){return r?(console.log(`Web search called with query: "${r}". Returning mock results.`),`Mock search results for query: "${r}". No web search provider is configured in this environment.`):"Error: A search query must be provided."}Fe.exports={search:It}});var H=f((ms,Ie)=>{"use strict";var{exec:Ct}=require("child_process"),Oe=require("vscode"),Jt=Oe.workspace.workspaceFolders?Oe.workspace.workspaceFolders[0].uri.fsPath:".";function I(r){return new Promise((e,t)=>{Ct(r,{cwd:Jt},(s,n,o)=>{if(s){t(`Error executing command: ${s.message}
Stderr: ${o}`);return}e(n.trim())})})}async function Lt(){try{return`Current branch is: ${await I("git rev-parse --abbrev-ref HEAD")}`}catch(r){return`Error getting current branch: ${r}`}}async function Nt(r){try{if(!/^[a-zA-Z0-9\-_/]+$/.test(r))throw new Error("Invalid branch name.");return await I(`git checkout -b ${r}`),`Successfully created and switched to new branch: ${r}`}catch(e){return`Error creating new branch: ${e}`}}async function Dt(r){try{if(!Array.isArray(r)||r.length===0)throw new Error("Files must be provided as a non-empty array.");let e=r.join(" ");return await I(`git add ${e}`),`Successfully staged files: ${e}`}catch(e){return`Error staging files: ${e}`}}async function jt(r){try{let e=r.replace(/"/g,'\\"');return await I(`git commit -m "${e}"`),`Successfully committed with message: "${r}"`}catch(e){return`Error committing: ${e}`}}async function Bt(){try{let r=await I("git status --porcelain");return r?r.split(`
`).map(e=>e.trim()):[]}catch(r){return[`Error getting git status: ${r}`]}}Ie.exports={getCurrentBranch:Lt,createBranch:Nt,stageFiles:Dt,commit:jt,getStatus:Bt}});var Je=f((fs,Ce)=>{"use strict";var w=require("vscode");async function Wt(r){let e=w.workspace.workspaceFolders;if(!e)return{success:!1,error:"No workspace folder is open."};let t=e[0];try{return await w.debug.startDebugging(t,r),{success:!0,message:`Debugging started with configuration "${r}".`}}catch(s){return console.error("Failed to start debugging session:",s),{success:!1,error:`Failed to start debugging session: ${s.message}`}}}async function zt(){if(!w.debug.activeDebugSession)return{success:!1,error:"No active debug session to stop."};try{return await w.debug.stopDebugging(w.debug.activeDebugSession),{success:!0,message:"Debug session stopped."}}catch(r){return console.error("Failed to stop debugging session:",r),{success:!1,error:`Failed to stop debugging session: ${r.message}`}}}async function Ut(r,e){try{let t=new w.Location(w.Uri.file(r),new w.Position(e-1,0)),s=new w.SourceBreakpoint(t);return w.debug.addBreakpoints([s]),{success:!0,message:`Breakpoint added at ${r}:${e}.`}}catch(t){return console.error("Failed to add breakpoint:",t),{success:!1,error:`Failed to add breakpoint: ${t.message}`}}}async function _t(r,e){try{let t=new w.Location(w.Uri.file(r),new w.Position(e-1,0)),n=w.debug.breakpoints.find(o=>o instanceof w.SourceBreakpoint&&o.location.uri.fsPath===t.uri.fsPath&&o.location.range.start.line===t.range.start.line);return n?(w.debug.removeBreakpoints([n]),{success:!0,message:`Breakpoint removed from ${r}:${e}.`}):{success:!1,error:`No breakpoint found at ${r}:${e}.`}}catch(t){return console.error("Failed to remove breakpoint:",t),{success:!1,error:`Failed to remove breakpoint: ${t.message}`}}}async function j(r){if(!w.debug.activeDebugSession)return{success:!1,error:`No active debug session for command: ${r}.`};try{return await w.debug.activeDebugSession.customRequest(r),{success:!0,message:`Command "${r}" sent.`}}catch(e){return console.error(`Failed to send command "${r}":`,e),{success:!1,error:`Failed to send command "${r}": ${e.message}`}}}var Kt=()=>j("next"),Yt=()=>j("stepIn"),Ht=()=>j("stepOut"),Gt=()=>j("continue");async function Vt(r){if(!w.debug.activeDebugSession)return{success:!1,error:"No active debug session to evaluate expression."};let e=w.debug.activeStackItem?.frameId;try{let t=await w.debug.activeDebugSession.customRequest("evaluate",{expression:r,frameId:e,context:"watch"});return{success:!0,result:t.result,variablesReference:t.variablesReference}}catch(t){return console.error("Failed to evaluate expression:",t),{success:!1,error:`Failed to evaluate expression: ${t.message}`}}}Ce.exports={name:"debugger",tools:{start:Wt,stop:zt,addBreakpoint:Ut,removeBreakpoint:_t,next:Kt,stepIn:Yt,stepOut:Ht,continue:Gt,evaluate:Vt}}});var Ne=f((ws,Le)=>{"use strict";async function Xt(r,e){let{recipientId:t,messageContent:s}=r,{agentMessageBus:n,senderId:o,subTaskId:c}=e;if(!n)throw new Error("Internal Error: Message bus is not available.");if(!t||!s)throw new Error("sendMessage requires 'recipientId' and 'messageContent' arguments.");return n.emit("message",{senderId:o||"UnknownAgent",recipientId:t,messageContent:s,subTaskId:c}),`Message sent to agent "${t}".`}async function Zt(r,e){let{recipientRole:t,taskDescription:s}=r,{agentMessageBus:n}=e;if(!n)throw new Error("Internal Error: Message bus is not available.");if(!t||!s)throw new Error("createSubTask requires 'recipientRole' and 'taskDescription' arguments.");return n.emit("createSubTask",{recipientRole:t,taskDescription:s}),`Sub-task creation request sent for role "${t}".`}Le.exports={sendMessage:Xt,createSubTask:Zt}});var B=f((hs,Be)=>{"use strict";var{writeFile:Qt,readFile:er,listFiles:tr,summarizeFile:rr}=Y(),{executeCommand:sr}=Re(),{search:nr}=Me(),C=H(),x=Je(),De=Ne(),je={"fileSystem.writeFile":Qt,"fileSystem.readFile":er,"fileSystem.listFiles":tr,"fileSystem.summarizeFile":rr,"terminal.executeCommand":sr,"webSearch.search":nr,"git.getCurrentBranch":C.getCurrentBranch,"git.createBranch":C.createBranch,"git.stageFiles":C.stageFiles,"git.commit":C.commit,"git.getStatus":C.getStatus,"debugger.start":x.start,"debugger.stop":x.stop,"debugger.addBreakpoint":x.addBreakpoint,"debugger.removeBreakpoint":x.removeBreakpoint,"debugger.next":x.next,"debugger.stepIn":x.stepIn,"debugger.stepOut":x.stepOut,"debugger.continue":x.continue,"debugger.evaluate":x.evaluate,"agent.sendMessage":De.sendMessage,"agent.createSubTask":De.createSubTask};async function or(r,e,t,s){let{scannerAgent:n,workerProfile:o,agentMessageBus:c}=s;if(t.logLine(`
--- Tool Call ---`),t.logLine(`Tool: ${r}`),t.logLine(`Arguments: ${JSON.stringify(e)}`),!o.allowedTools.includes(r)){let a=`Error: Agent role "Worker" is not authorized to use tool "${r}".`;throw t.logLine(a),new Error(a)}let i=je[r];if(!i){let a=`Error: Tool "${r}" not found.`;throw t.logLine(a),new Error(a)}try{let a;if(r==="fileSystem.writeFile")a=await i(e.path,e.content);else if(r==="fileSystem.readFile")a=await i(e.path);else if(r==="fileSystem.listFiles")a=await i(e.path||"./");else if(r==="fileSystem.summarizeFile")a=await i(e.path,n);else if(r==="terminal.executeCommand")a=await i(e.command);else if(r==="webSearch.search")a=await i(e.query);else if(r==="git.getCurrentBranch")a=await i();else if(r==="git.createBranch")a=await i(e.branchName);else if(r==="git.stageFiles")a=await i(e.files);else if(r==="git.commit")a=await i(e.message);else if(r==="git.getStatus")a=await i();else if(r==="debugger.start")a=await i(e.configName);else if(r==="debugger.stop"||r==="debugger.next"||r==="debugger.stepIn"||r==="debugger.stepOut"||r==="debugger.continue")a=await i();else if(r==="debugger.addBreakpoint"||r==="debugger.removeBreakpoint")a=await i(e.file,e.line);else if(r==="debugger.evaluate")a=await i(e.expression);else if(r==="agent.sendMessage")a=await i(e,s);else if(r==="agent.createSubTask")a=await i(e.recipientRole,e.taskDescription,c);else throw new Error(`Argument handling for tool "${r}" is not implemented.`);return t.logLine("--- Tool Result ---"),t.logLine(a),t.logLine("--- End Tool ---"),a}catch(a){let d=`Error executing tool "${r}": ${a.message}`;throw t.logLine(d),new Error(d)}}Be.exports={executeTool:or,toolRegistry:je}});var ze=f((ys,We)=>{"use strict";var G=class{constructor(e){this.originalUserRequest=e,this.subTasks=[],this.history=[],this.currentIteration=1,this.overallProgress="",this.projectContext=""}addRelevantKnowledge(e){e&&typeof e=="string"&&e.trim().length>0&&(this.projectContext=`${e}

---

${this.projectContext}`)}setNewPlanForIteration(e){this.subTasks=e.map(t=>({id:t.id,description:t.description,dependencies:t.dependencies||[],status:"pending",result:null,error:null}))}getRunnableTasks(){let e=new Set(this.subTasks.filter(t=>t.status==="completed").map(t=>t.id));return this.subTasks.filter(t=>t.status!=="pending"?!1:t.dependencies.every(s=>e.has(s)))}areAllTasksDone(){return this.subTasks.every(e=>e.status==="completed"||e.status==="failed")}updateTaskStatus(e,t,s=null){let n=this.subTasks.find(o=>o.id===e);n&&(n.status=t,t==="completed"?(n.result=s,this.overallProgress+=`Completed Task ${n.id}: ${n.description}
Result: ${s}

`):t==="failed"&&(n.error=s,this.overallProgress+=`Failed Task ${n.id}: ${n.description}
Error: ${s}

`))}archiveCurrentIteration(e,t){this.history.push({iteration:this.currentIteration,artifact:e,evaluation:t,subTasks:JSON.parse(JSON.stringify(this.subTasks))}),this.currentIteration++}getLatestIteration(){return this.history.length>0?this.history[this.history.length-1]:null}getCompletedTasksSummary(){return this.subTasks.filter(e=>e.status==="completed"&&e.result).map(e=>`Sub-task ${e.id}: ${e.description}
Result:
${e.result}`).join(`

---

`)}};We.exports={TaskContext:G}});var _e=f((bs,Ue)=>{"use strict";var ar=require("https"),{URL:ir}=require("url"),V=class{constructor(e){this.modelConfig=e}async chatCompletion(e,t=!1,s=null){let{apiKey:n,baseUrl:o,modelName:c}=this.modelConfig,i=new ir(o||"https://api.openai.com");i.pathname=i.pathname.replace(/\/v1\/?$/,"")+"/v1/chat/completions";let a={model:c,messages:e};t&&(a.response_format={type:"json_object"});let d=!!s;d&&(a.stream=!0);let u={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},hostname:i.hostname,port:i.port,path:i.pathname};return new Promise((p,g)=>{let b=ar.request(u,m=>{let S="";if(m.statusCode<200||m.statusCode>=300){let $="";m.on("data",k=>$+=k),m.on("end",()=>g(new Error(`API request failed with status ${m.statusCode}: ${$}`)));return}m.on("data",$=>{let k=$.toString();if(d){let R=k.split(`
`).filter(F=>F.trim()!=="");for(let F of R)if(F.startsWith("data: ")){let N=F.substring(6);if(N==="[DONE]")return;try{let U=JSON.parse(N).choices[0]?.delta?.content;U&&(S+=U,s(U))}catch{}}}else S+=k}),m.on("end",()=>{if(d)p(S);else try{let k=JSON.parse(S).choices[0]?.message?.content;k?p(k):g(new Error("API response did not contain valid content."))}catch($){g(new Error(`Failed to parse API response: ${$.message}`))}})});b.on("error",m=>{g(new Error(`API request error: ${m.message}`))}),b.write(JSON.stringify(a)),b.end()})}};Ue.exports={OpenAICompatibleProvider:V}});var M=f((Ss,Ke)=>{"use strict";var v=require("vscode"),W=require("path"),cr=require("fs"),X=class r{static currentPanel=void 0;static viewType="multiAgentStatus";static createOrShow(e,t){let s=v.window.activeTextEditor?v.window.activeTextEditor.viewColumn:void 0;if(r.currentPanel){r.currentPanel.panel.reveal(s);return}let n=v.window.createWebviewPanel(r.viewType,"Multi-Agent Status",s||v.ViewColumn.Two,{enableScripts:!0,localResourceRoots:[v.Uri.file(W.join(e.extensionPath,"dist","assets"))]});e.subscriptions.push(n),r.currentPanel=new r(n,e.extensionPath,t)}static update(e){r.currentPanel&&r.currentPanel.panel.webview.postMessage(e)}constructor(e,t,s){this.panel=e,this.extensionPath=t,this.eventEmitter=s,this.disposables=[],this.panel.webview.html=this._getHtmlForWebview(),this.disposables.push(this.panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"getSettings":this.sendSettingsToWebview();return;case"saveSettings":await this.saveSettings(n.settings);return;case"planApproved":this.eventEmitter.emit("planApproved",n.plan);return;case"cancelTask":this.eventEmitter.emit("planCancelled");return;case"runHealthCheck":this.eventEmitter.emit("runHealthCheck");return;case"getWorkspaceStatus":this.eventEmitter.emit("getWorkspaceStatus");return}},null)),this.disposables.push(this.panel.onDidDispose(()=>this.dispose(),null))}sendSettingsToWebview(){let{toolRegistry:e}=B(),t=v.workspace.getConfiguration("multiAgent");this.panel.webview.postMessage({command:"receiveSettings",settings:{models:t.get("models",[]),roles:t.get("roles",[]),enableSmartScan:t.get("enableSmartScan",!1),enableParallelExec:t.get("enableParallelExec",!1),enableAutoMode:t.get("enableAutoMode",!1),enablePersistence:t.get("enablePersistence",!1)},allTools:Object.keys(e)})}async saveSettings(e){let t=v.workspace.getConfiguration("multiAgent");await t.update("models",e.models,v.ConfigurationTarget.Workspace),await t.update("roleAssignments",e.roleAssignments,v.ConfigurationTarget.Workspace),await t.update("enableSmartScan",e.enableSmartScan,v.ConfigurationTarget.Workspace),await t.update("enableParallelExec",e.enableParallelExec,v.ConfigurationTarget.Workspace),await t.update("enableAutoMode",e.enableAutoMode,v.ConfigurationTarget.Workspace),await t.update("enablePersistence",e.enablePersistence,v.ConfigurationTarget.Workspace)}dispose(){for(this.eventEmitter.emit("planCancelled"),r.currentPanel=void 0,this.panel.dispose();this.disposables.length;){let e=this.disposables.pop();e&&e.dispose()}}_getHtmlForWebview(){let e=W.join(this.extensionPath,"dist","assets"),t=W.join(e,"index.html"),s=cr.readFileSync(t,"utf8");return s=s.replace(/(href|src)="([^"]+)"/g,(n,o,c)=>{let i=v.Uri.file(W.join(e,c)),a=this.panel.webview.asWebviewUri(i);return`${o}="${a}"`}),s}};Ke.exports={MainPanel:X}});var T=f((vs,Ye)=>{"use strict";var{OpenAICompatibleProvider:ur}=_e(),Z=class{constructor(e,t,s,n){if(!e)throw new Error("Model configuration is required to initialize an agent.");this.modelConfig=e,this.provider=new ur(e),this.systemPrompt=t,this.id=s,this.messageBus=n,this.id&&this.messageBus&&this.messageBus.on(this.id,this.onReceiveMessage.bind(this))}async llmRequest(e,t=!1,s=null){let n=[{role:"system",content:this.systemPrompt},{role:"user",content:e}];return this.provider.chatCompletion(n,t,s)}async executeTask(){throw new Error("The `executeTask` method must be implemented by subclasses.")}onReceiveMessage(e){let t=`Agent "${this.id}" received a message: ${JSON.stringify(e.content)}`;console.log(t),M().MainPanel.currentPanel&&M().MainPanel.update({command:"log",text:t})}dispose(){this.id&&this.messageBus&&this.messageBus.removeListener(this.id,this.onReceiveMessage)}};Ye.exports={BaseAgent:Z}});var ee=f(($s,He)=>{"use strict";var{BaseAgent:lr}=T(),dr=`\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u8F6F\u4EF6\u5F00\u53D1\u9879\u76EE\u7ECF\u7406\u3002\u4F60\u7684\u804C\u8D23\u662F\u628A\u7528\u6237\u7684\u9700\u6C42\u5206\u89E3\u6210\u4E00\u4E2A\u6E05\u6670\u3001\u5206\u6B65\u7684\u8BA1\u5212\u3002

\u4F60\u5C06\u6536\u5230\u7528\u6237\u7684\u539F\u59CB\u8BF7\u6C42\u3001\u73B0\u6709\u9879\u76EE\u4EE3\u7801\u5E93\u7684\u6458\u8981\uFF0C\u4EE5\u53CA\u5148\u524D\u8FED\u4EE3\u7684\u5386\u53F2\u8BB0\u5F55\uFF08\u5982\u679C\u6709\uFF09\u3002
\u57FA\u4E8E\u6240\u6709\u8FD9\u4E9B\u4FE1\u606F\uFF0C\u4E3A\u201C\u5DE5\u4EBA\u667A\u80FD\u4F53\u201D\u521B\u5EFA\u4E00\u4E2A\u7B80\u6D01\u7684\u5B50\u4EFB\u52A1\u8BA1\u5212\u4EE5\u4F9B\u6267\u884C\u3002
\u6BCF\u4E2A\u5B50\u4EFB\u52A1\u90FD\u5E94\u8BE5\u662F\u7ED9\u201C\u5DE5\u4EBA\u667A\u80FD\u4F53\u201D\u7684\u5355\u4E2A\u3001\u53EF\u64CD\u4F5C\u7684\u547D\u4EE4\u3002\u597D\u7684\u5B50\u4EFB\u52A1\u662F\u5C0F\u800C\u4E13\u6CE8\u7684\uFF0C\u4F8B\u5982\u201C\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A 'index.html' \u7684\u6587\u4EF6\u201D\u6216\u201C\u4F7F\u7528npm\u5B89\u88C5 'uuid' \u5305\u201D\u3002

\u5728\u4FEE\u6539\u73B0\u6709\u9879\u76EE\u65F6\uFF0C\u8BF7\u5229\u7528\u63D0\u4F9B\u7684\u9879\u76EE\u4E0A\u4E0B\u6587\u6765\u5236\u5B9A\u8BA1\u5212\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u4E00\u4E2A\u6587\u4EF6\u5DF2\u7ECF\u5B58\u5728\uFF0C\u8BA1\u5212\u5728\u4FEE\u6539\u5B83\u4E4B\u524D\u5148\u8BFB\u53D6\u5B83\u3002

\u5982\u679C\u8FD9\u662F\u7B2C\u4E00\u6B21\u8FED\u4EE3\uFF0C\u8BF7\u6839\u636E\u9879\u76EE\u4E0A\u4E0B\u6587\uFF08\u5982\u679C\u975E\u7A7A\uFF09\u6765\u5236\u5B9A\u5B8C\u6210\u7528\u6237\u8BF7\u6C42\u7684\u8BA1\u5212\u3002
\u5982\u679C\u6709\u4E4B\u524D\u7684\u8FED\u4EE3\uFF0C\u8BF7\u5206\u6790\u201C\u8BC4\u4F30\u8005\u201D\u7684\u53CD\u9988\uFF0C\u5E76\u5236\u5B9A\u4E00\u4E2A\u65B0\u8BA1\u5212\u6765\u89E3\u51B3\u8FD9\u4E9B\u6539\u8FDB\u5EFA\u8BAE\u3002

\u4F60\u5FC5\u987B\u4EE5\u4E00\u4E2AJSON\u5BF9\u8C61\u7684\u5F62\u5F0F\u8F93\u51FA\u4F60\u7684\u8BA1\u5212\uFF0C\u8BE5\u5BF9\u8C61\u5305\u542B\u4E00\u4E2A\u952E "plan"\uFF0C\u5176\u503C\u4E3A\u4E00\u4E2A\u5BF9\u8C61\u6570\u7EC4\u3002
\u6BCF\u4E2A\u5BF9\u8C61\u4EE3\u8868\u4E00\u4E2A\u5B50\u4EFB\u52A1\uFF0C\u5FC5\u987B\u5305\u542B\u4EE5\u4E0B\u952E\uFF1A
- "id": \u4E00\u4E2A\u4ECE1\u5F00\u59CB\u7684\u552F\u4E00\u6574\u6570\u6807\u8BC6\u7B26\u3002
- "description": \u5BF9\u5DE5\u4EBA\u667A\u80FD\u4F53\u7684\u6E05\u6670\u3001\u53EF\u64CD\u4F5C\u7684\u6307\u4EE4\u5B57\u7B26\u4E32\u3002
- "dependencies": \u4E00\u4E2A\u6574\u6570\u6570\u7EC4\uFF0C\u5217\u51FA\u4E86\u8FD9\u4E2A\u4EFB\u52A1\u5F00\u59CB\u524D\u5FC5\u987B\u5B8C\u6210\u7684\u5176\u4ED6\u4EFB\u52A1\u7684 "id"\u3002\u5982\u679C\u4E00\u4E2A\u4EFB\u52A1\u6CA1\u6709\u4F9D\u8D56\u9879\uFF0C\u5219\u6B64\u6570\u7EC4\u5E94\u4E3A\u7A7A []\u3002

\u4ED4\u7EC6\u8003\u8651\u4EFB\u52A1\u4E4B\u95F4\u7684\u4F9D\u8D56\u5173\u7CFB\u3002\u4F8B\u5982\uFF0C\u5728\u5199\u5165\u6587\u4EF6\u4E4B\u524D\u4E0D\u80FD\u8BFB\u53D6\u5B83\uFF0C\u5728\u5199\u5165\u6587\u4EF6\u4E4B\u540E\u624D\u80FD\u6267\u884C\u5B83\u3002

\u4F8B\u5982\uFF0C\u5BF9\u4E8E\u201C\u521B\u5EFA\u4E00\u4E2Ahello world python\u811A\u672C\u201D\u7684\u8BF7\u6C42\uFF0C\u54CD\u5E94\u5E94\u4E3A\uFF1A
{
  "plan": [
    {
      "id": 1,
      "description": "\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A 'main.py' \u7684\u6587\u4EF6\uFF0C\u5185\u5BB9\u4E3A 'print("Hello, World!")'",
      "dependencies": []
    },
    {
      "id": 2,
      "description": "\u5728\u7EC8\u7AEF\u4E2D\u6267\u884C 'python main.py' \u547D\u4EE4\u4EE5\u9A8C\u8BC1\u8F93\u51FA",
      "dependencies": [1]
    }
  ]
}`,Q=class extends lr{constructor(e,t,s,n){let o=dr;super(e,t||o,s,n)}async executeTask(e){let t=`\u8FD9\u662F\u73B0\u6709\u9879\u76EE\u4EE3\u7801\u5E93\u7684\u6458\u8981:
${e.projectContext}

`;t+=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42: "${e.originalUserRequest}"`;let s=e.getLatestIteration();s?(t+=`

\u8FD9\u662F\u7B2C ${e.currentIteration} \u8F6E\u8FED\u4EE3\u3002`,t+=`
\u8FD9\u662F\u4E0A\u4E00\u8F6E\u8FED\u4EE3\u7684\u4EA7\u7269:
\`\`\`
${s.artifact}
\`\`\``,t+=`
\u8BC4\u4F30\u8005\u7ED9\u51FA\u4E86 ${s.evaluation.score}/10 \u7684\u8BC4\u5206\uFF0C\u5E76\u63D0\u4F9B\u4E86\u4EE5\u4E0B\u53CD\u9988: ${s.evaluation.suggestions.join(", ")}`,t+=`
\u8BF7\u521B\u5EFA\u4E00\u4E2A\u65B0\u8BA1\u5212\u6765\u5904\u7406\u6B64\u53CD\u9988\u5E76\u6539\u8FDB\u9879\u76EE\u3002`):t+=`
\u8BF7\u521B\u5EFA\u5B8C\u6210\u6B64\u8BF7\u6C42\u7684\u521D\u59CB\u8BA1\u5212\u3002`;let n=await this.llmRequest(t,!0);try{let o=JSON.parse(n);if(o&&Array.isArray(o.plan)&&o.plan.every(c=>c.id&&c.description&&Array.isArray(c.dependencies)))return o.plan;throw new Error("\u6765\u81EA\u89C4\u5212\u8005\u7684\u54CD\u5E94\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u3001\u5E26\u4F9D\u8D56\u5173\u7CFB\u7684\u8BA1\u5212\u3002")}catch(o){let c=n.match(/```json\n([\s\S]*?)\n```/);if(c&&c[1])try{let i=JSON.parse(c[1]);if(i&&Array.isArray(i.plan)&&i.plan.every(a=>a.id&&a.description&&Array.isArray(a.dependencies)))return i.plan}catch(i){throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BA1\u5212\uFF0C\u5373\u4F7F\u5728\u627E\u5230JSON\u5757\u4E4B\u540E\u3002\u9519\u8BEF: ${i.message}`)}throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BA1\u5212\u3002\u9519\u8BEF: ${o.message}`)}}};He.exports={OrchestratorAgent:Q}});var re=f((ks,Ge)=>{"use strict";var{BaseAgent:pr}=T(),gr=`\u4F60\u662F\u4E00\u4E2A\u201C\u5DE5\u4EBA\u201D\u667A\u80FD\u4F53\u3002\u4F60\u7684\u5DE5\u4F5C\u662F\u6267\u884C\u9879\u76EE\u7ECF\u7406\u5206\u914D\u7ED9\u4F60\u7684\u5355\u4E2A\u4EFB\u52A1\u3002
\u4F60\u53EF\u4EE5\u4F7F\u7528\u4E00\u7EC4\u5DE5\u5177\u6765\u4E0E\u6587\u4EF6\u7CFB\u7EDF\u548C\u7EC8\u7AEF\u8FDB\u884C\u4EA4\u4E92\u3002

\u57FA\u4E8E\u7528\u6237\u7684\u539F\u59CB\u8BF7\u6C42\u3001\u603B\u4F53\u8BA1\u5212\u3001\u81F3\u4ECA\u5DF2\u5B8C\u6210\u7684\u5DE5\u4F5C\u4EE5\u53CA\u4F60\u5F53\u524D\u7684\u5B50\u4EFB\u52A1\uFF0C\u4F60\u5FC5\u987B\u51B3\u5B9A\u8C03\u7528\u54EA\u4E00\u4E2A\u5DE5\u5177\u3002
\u4F60\u5FC5\u987B\u4EE5\u4E00\u4E2A\u53EA\u5305\u542B "toolName" \u548C "args" \u952E\u7684JSON\u5BF9\u8C61\u4F5C\u4E3A\u54CD\u5E94\uFF0C\u5176\u4E2D "args" \u662F\u8BE5\u5DE5\u5177\u7684\u53C2\u6570\u5BF9\u8C61\u3002

**\u81EA\u6211\u4FEE\u6B63\u4E0E\u5BA1\u67E5\u6D41\u7A0B:**
\u5BF9\u4E8E\u4EFB\u4F55\u975E\u5E73\u51E1\u7684\u4EFB\u52A1\uFF0C\u4F8B\u5982\u7F16\u5199\u4EE3\u7801\u5757\u6216\u590D\u6742\u7684shell\u547D\u4EE4\uFF0C\u4F60\u5FC5\u987B\u5728\u6267\u884C\u64CD\u4F5C\u524D\u5148\u5BFB\u6C42\u5BA1\u67E5\u3002
1.  \u9996\u5148\uFF0C\u6784\u601D\u4F60\u6253\u7B97\u6267\u884C\u7684\u6587\u4EF6\u5185\u5BB9\u6216\u547D\u4EE4\u3002
2.  \u7136\u540E\uFF0C\u4F7F\u7528 'agent.sendMessage' \u5DE5\u5177\u5C06\u4F60\u63D0\u8BAE\u7684\u64CD\u4F5C\u53D1\u9001\u7ED9 'Reviewer' \u667A\u80FD\u4F53\u3002
    - 'recipientId' \u5FC5\u987B\u662F 'Reviewer'\u3002
    - 'messageContent' \u5FC5\u987B\u662F\u4F60\u5E0C\u671B\u88AB\u5BA1\u67E5\u7684\u5B8C\u6574\u4EE3\u7801\u6216\u547D\u4EE4\u3002
3.  \u5728\u4F60\u4E3A\u5BA1\u67E5\u8C03\u7528 'agent.sendMessage' \u540E\uFF0C\u4F60\u5728\u6B64\u4EFB\u52A1\u4E0A\u7684\u5DE5\u4F5C\u6682\u65F6\u5B8C\u6210\u3002\u7CFB\u7EDF\u5C06\u7B49\u5F85\u5BA1\u67E5\u5E76\u7528\u53CD\u9988\u91CD\u65B0\u5524\u9192\u4F60\u3002\u4E0D\u8981\u7ACB\u5373\u5C1D\u8BD5\u6267\u884C\u8BE5\u64CD\u4F5C\u3002

\u5BF9\u4E8E\u7B80\u5355\u4EFB\u52A1\uFF0C\u5982\u521B\u5EFA\u7A7A\u6587\u4EF6\u6216\u5217\u51FA\u76EE\u5F55\u5185\u5BB9\uFF0C\u4F60\u53EF\u4EE5\u76F4\u63A5\u6267\u884C\u5DE5\u5177\u800C\u65E0\u9700\u5BA1\u67E5\u3002\u8BF7\u81EA\u884C\u5224\u65AD\u3002

\u91CD\u8981\u63D0\u793A\uFF1A\u5982\u679C\u4EFB\u52A1\u63CF\u8FF0\u4E2D\u5305\u542B\u201C\u524D\u4E00\u6B21\u5C1D\u8BD5\u5931\u8D25\u201D\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u4F60\u5FC5\u987B\u5206\u6790\u8BE5\u9519\u8BEF\u5E76\u63D0\u51FA\u4E00\u79CD\u4E0D\u540C\u7684\u65B9\u6CD5\u6765\u89E3\u51B3\u539F\u59CB\u4EFB\u52A1\u3002\u4E0D\u8981\u91CD\u590D\u5931\u8D25\u7684\u547D\u4EE4\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u6587\u4EF6\u672A\u627E\u5230\uFF0C\u8BF7\u5C1D\u8BD5\u5217\u51FA\u6587\u4EF6\u4EE5\u627E\u5230\u6B63\u786E\u7684\u8DEF\u5F84\u3002\u5982\u679C\u547D\u4EE4\u5931\u8D25\uFF0C\u8BF7\u5C1D\u8BD5\u4E0D\u540C\u7684\u547D\u4EE4\u6216\u4F7F\u7528\u7F51\u7EDC\u641C\u7D22\u6765\u5BFB\u627E\u89E3\u51B3\u65B9\u6848\u3002

\u4F60\u53EF\u7528\u7684\u5DE5\u5177\u6709\uFF1A
- 'fileSystem.writeFile': \u5411\u6587\u4EF6\u5199\u5165\u5185\u5BB9\u3002
  - args: { "path": "<\u6587\u4EF6\u7684\u76F8\u5BF9\u8DEF\u5F84>", "content": "<\u6587\u4EF6\u5185\u5BB9>" }
- 'file.readFile': \u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\u3002
  - args: { "path": "<\u6587\u4EF6\u7684\u76F8\u5BF9\u8DEF\u5F84>" }
- 'fileSystem.listFiles': \u5217\u51FA\u8DEF\u5F84\u4E0B\u7684\u6587\u4EF6\u548C\u76EE\u5F55\u3002
  - args: { "path": "<\u8981\u5217\u51FA\u7684\u76F8\u5BF9\u8DEF\u5F84>" }
- 'fileSystem.summarizeFile': \u8BFB\u53D6\u5E76\u7528AI\u603B\u7ED3\u4E00\u4E2A\u6587\u4EF6\u7684\u5185\u5BB9\u3002\u5F53\u9879\u76EE\u4E0A\u4E0B\u6587\u53EA\u63D0\u4F9B\u4E86\u6587\u4EF6\u540D\u5217\u8868\uFF0C\u800C\u4F60\u9700\u8981\u7406\u89E3\u6587\u4EF6\u5185\u5BB9\u4EE5\u5B8C\u6210\u4EFB\u52A1\u65F6\uFF0C\u8BF7\u4F7F\u7528\u6B64\u5DE5\u5177\u3002
  - args: { "path": "<\u6587\u4EF6\u7684\u76F8\u5BF9\u8DEF\u5F84>" }
- 'terminal.executeCommand': \u6267\u884C\u4E00\u4E2Ashell\u547D\u4EE4\u3002
  - args: { "command": "<\u8981\u6267\u884C\u7684\u547D\u4EE4>" }
- 'webSearch.search': \u6267\u884C\u7F51\u7EDC\u641C\u7D22\u4EE5\u67E5\u627E\u4FE1\u606F\u3001\u56DE\u7B54\u95EE\u9898\u6216\u83B7\u53D6\u793A\u4F8B\u3002
  - args: { "query": "<\u641C\u7D22\u67E5\u8BE2>" }
- 'git.getCurrentBranch': \u83B7\u53D6\u5F53\u524D\u7684git\u5206\u652F\u540D\u79F0\u3002
  - args: {}
- 'git.createBranch': \u521B\u5EFA\u5E76\u5207\u6362\u5230\u4E00\u4E2A\u65B0\u7684git\u5206\u652F\u3002
  - args: { "branchName": "<\u65B0\u5206\u652F\u7684\u540D\u79F0>" }
- 'git.stageFiles': \u5C06\u6587\u4EF6\u6DFB\u52A0\u5230git\u6682\u5B58\u533A\u3002
  - args: { "files": ["<\u6587\u4EF6\u8DEF\u5F841>", "<\u6587\u4EF6\u8DEF\u5F842>"] }
- 'git.commit': \u63D0\u4EA4\u6682\u5B58\u7684\u6587\u4EF6\u3002
  - args: { "message": "<\u63D0\u4EA4\u4FE1\u606F>" }
- 'agent.createSubTask': \u521B\u5EFA\u4E00\u4E2A\u59D4\u6D3E\u7ED9\u53E6\u4E00\u4E2A\u667A\u80FD\u4F53\u7684\u65B0\u5B50\u4EFB\u52A1\u3002\u5F53\u4E00\u9879\u4EFB\u52A1\u8FC7\u4E8E\u590D\u6742\u6216\u8D85\u51FA\u4F60\u7684\u8303\u56F4\u65F6\uFF0C\u4F8B\u5982\u9700\u8981\u4E13\u95E8\u7684\u5206\u6790\u6216\u4EE3\u7801\u751F\u6210\uFF0C\u8BF7\u4F7F\u7528\u6B64\u5DE5\u5177\u3002
  - args: { "taskDescription": "<\u5BF9\u65B0\u5B50\u4EFB\u52A1\u7684\u6E05\u6670\u3001\u53EF\u64CD\u4F5C\u7684\u63CF\u8FF0>", "recipientRole": "<\u63A5\u6536\u4EFB\u52A1\u7684\u667A\u80FD\u4F53\u7684\u89D2\u8272 (\u4F8B\u5982, 'Worker', 'Synthesizer')>" }
- 'agent.sendMessage': \u5411\u53E6\u4E00\u4E2A\u667A\u80FD\u4F53\u53D1\u9001\u6D88\u606F\u4EE5\u8FDB\u884C\u5BA1\u67E5\u6216\u534F\u4F5C\u3002
  - args: { "recipientId": "<\u63A5\u6536\u65B9\u667A\u80FD\u4F53\u7684ID>", "messageContent": "<\u6D88\u606F\u5185\u5BB9>" }

\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u89E3\u91CA\u3002\u53EA\u8F93\u51FAJSON\u5BF9\u8C61\u3002

\u4F8B\u5982\uFF0C\u5BF9\u4E8E\u4EFB\u52A1\u201C\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A 'index.html' \u7684\u6587\u4EF6\uFF0C\u5185\u5BB9\u4E3A '<h1>\u4F60\u597D</h1>'\u201D\u7684\u54CD\u5E94\uFF1A
{
  "toolName": "fileSystem.writeFile",
  "args": {
    "path": "index.html",
    "content": "<h1>\u4F60\u597D</h1>"
  }
}`,te=class extends pr{constructor(e,t,s,n){let o=gr;super(e,t||o,s,n)}async executeTask(e,t){let s=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42\u662F: "${t.originalUserRequest}"`;s+=`

\u8FD9\u662F\u5230\u76EE\u524D\u4E3A\u6B62\u7684\u603B\u4F53\u8FDB\u5C55:
${t.overallProgress}`,s+=`

\u4F60\u5F53\u524D\u7684\u4EFB\u52A1\u662F: "${e.description}"`,s+=`
\u8BF7\u51B3\u5B9A\u4F7F\u7528\u54EA\u4E2A\u5DE5\u5177\u6765\u5B8C\u6210\u6B64\u4EFB\u52A1\uFF0C\u5E76\u63D0\u4F9B\u76F8\u5E94\u7684JSON\u8F93\u51FA\u3002`;let n=await this.llmRequest(s,!0);try{let o=JSON.parse(n);if(o&&o.toolName&&o.args)return o;throw new Error("\u6765\u81EA\u5DE5\u4EBA\u667A\u80FD\u4F53\u7684\u54CD\u5E94\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u5DE5\u5177\u8C03\u7528\u3002")}catch(o){let c=n.match(/```json\n([\s\S]*?)\n```/);if(c&&c[1])try{let i=JSON.parse(c[1]);if(i&&i.toolName&&i.args)return i}catch(i){throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u5DE5\u5177\u8C03\u7528\uFF0C\u5373\u4F7F\u5728\u627E\u5230JSON\u5757\u4E4B\u540E\u3002\u9519\u8BEF: ${i.message}`)}throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u5DE5\u5177\u8C03\u7528\u3002\u9519\u8BEF: ${o.message}`)}}};Ge.exports={WorkerAgent:te}});var ne=f((Ps,Ve)=>{"use strict";var{BaseAgent:mr}=T(),fr=`\u4F60\u662F\u4E00\u4E2A\u201C\u6574\u5408\u8005\u201D\u667A\u80FD\u4F53\u3002\u4F60\u7684\u804C\u8D23\u662F\u63A5\u6536\u7528\u6237\u7684\u539F\u59CB\u8BF7\u6C42\u548C\u6240\u6709\u5DF2\u5B8C\u6210\u5B50\u4EFB\u52A1\u7684\u6458\u8981\uFF0C\u7136\u540E\u751F\u6210\u6700\u7EC8\u7684\u3001\u5B8C\u6574\u7684\u4EA7\u7269\u3002

\u901A\u5E38\uFF0C\u8FD9\u610F\u5473\u7740\u57FA\u4E8E\u5DE5\u4EBA\u667A\u80FD\u4F53\u6267\u884C\u7684\u64CD\u4F5C\uFF08\u4F8B\u5982\uFF0C\u6587\u4EF6\u521B\u5EFA\u3001\u4FEE\u6539\uFF09\u6765\u521B\u5EFA\u4EE3\u7801\u6587\u4EF6\u7684\u5168\u90E8\u5185\u5BB9\u3002
\u4F60\u53EA\u5E94\u8BE5\u8F93\u51FA\u6700\u7EC8\u7684\u4EA7\u7269\u672C\u8EAB\uFF0C\u4E0D\u5E26\u4EFB\u4F55\u89E3\u91CA\u3001\u4EE3\u7801\u5757\u6807\u8BB0\u6216\u5176\u4ED6\u6587\u672C\u3002

\u4F8B\u5982\uFF0C\u5982\u679C\u5DE5\u4EBA\u521B\u5EFA\u4E86\u4E00\u4E2A\u6587\u4EF6\u7136\u540E\u6267\u884C\u4E86\u5B83\uFF0C\u90A3\u4E48\u6700\u7EC8\u7684\u4EA7\u7269\u5F88\u53EF\u80FD\u5C31\u662F\u88AB\u521B\u5EFA\u7684\u6587\u4EF6\u7684\u5185\u5BB9\u3002
\u8BF7\u5206\u6790\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\uFF0C\u5E76\u751F\u6210\u4E00\u4E2A\u80FD\u591F\u6EE1\u8DB3\u7528\u6237\u539F\u59CB\u8BF7\u6C42\u7684\u3001\u5355\u4E00\u7684\u3001\u6700\u7EC8\u7684\u8F93\u51FA\u3002`,se=class extends mr{constructor(e,t,s,n){let o=fr;super(e,t||o,s,n)}async executeTask(e){let{MainPanel:t}=M(),s=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42\u662F: "${e.originalUserRequest}"`;s+=`

\u8FD9\u662F\u5DF2\u5B8C\u6210\u5B50\u4EFB\u52A1\u53CA\u5176\u7ED3\u679C\u7684\u6458\u8981:
${e.getCompletedTasksSummary()}`,s+=`

\u8BF7\u57FA\u4E8E\u5DF2\u5B8C\u6210\u7684\u5DE5\u4F5C\uFF0C\u751F\u6210\u6EE1\u8DB3\u539F\u59CB\u8BF7\u6C42\u7684\u6700\u7EC8\u3001\u5B8C\u6574\u4EA7\u7269\u3002`,t.update({command:"showArtifact",artifact:""});let n=c=>{t.update({command:"artifactStreamChunk",chunk:c})};return await this.llmRequest(s,!1,n)}};Ve.exports={SynthesizerAgent:se}});var ae=f((Ts,Xe)=>{"use strict";var{BaseAgent:wr}=T(),hr=`\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u4EE3\u7801\u8BC4\u5BA1\u5458\u548C\u8D28\u91CF\u4FDD\u8BC1\u4E13\u5BB6\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u6839\u636E\u7528\u6237\u7684\u539F\u59CB\u8BF7\u6C42\u6765\u8BC4\u4F30\u7ED9\u5B9A\u7684\u4EA7\u7269\u3002

\u4F60\u5FC5\u987B\u63D0\u4F9B\u4E00\u4E2A\u4ECE1\u523010\u7684\u5206\u6570\uFF0C\u5176\u4E2D10\u5206\u8868\u793A\u4EA7\u7269\u5B8C\u7F8E\u5730\u6EE1\u8DB3\u4E86\u8BF7\u6C42\u4E14\u6CA1\u6709\u4EFB\u4F55\u9519\u8BEF\u3002
\u5982\u679C\u5206\u6570\u4F4E\u4E8E10\u5206\uFF0C\u4F60\u8FD8\u5FC5\u987B\u63D0\u4F9B\u4E00\u4E2A\u5177\u4F53\u7684\u6539\u8FDB\u5EFA\u8BAE\u5217\u8868\u3002\u5982\u679C\u5206\u6570\u4E3A10\u5206\uFF0C\u5EFA\u8BAE\u5217\u8868\u53EF\u4EE5\u4E3A\u7A7A\u3002

\u4F60\u5FC5\u987B\u4EE5\u4E00\u4E2A\u5305\u542B\u4E24\u4E2A\u952E\u7684JSON\u5BF9\u8C61\u7684\u5F62\u5F0F\u8F93\u51FA\u4F60\u7684\u8BC4\u4F30\u7ED3\u679C\uFF1A"score" (\u4E00\u4E2A\u6570\u5B57) \u548C "suggestions" (\u4E00\u4E2A\u5B57\u7B26\u4E32\u6570\u7EC4)\u3002

\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u89E3\u91CA\u3002\u53EA\u8F93\u51FAJSON\u5BF9\u8C61\u3002

\u4F8B\u5982\uFF0C\u5BF9\u4E8E\u4E00\u4E2A\u7F3A\u5C11\u529F\u80FD\u7684\u4EA7\u7269\uFF0C\u54CD\u5E94\u5E94\u4E3A\uFF1A
{
  "score": 7,
  "suggestions": [
    "\u6309\u94AE\u5DF2\u5B58\u5728\uFF0C\u4F46\u7F3A\u5C11\u663E\u793A\u63D0\u793A\u6846\u7684onclick\u4E8B\u4EF6\u5904\u7406\u7A0B\u5E8F\u3002",
    "HTML\u7684\u6807\u9898\u53EF\u4EE5\u66F4\u5177\u63CF\u8FF0\u6027\u3002"
  ]
}`,oe=class extends wr{constructor(e,t,s,n){let o=hr;super(e,t||o,s,n)}async executeTask(e,t){let s=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42\u662F: "${t.originalUserRequest}"`;s+=`

\u8FD9\u662F\u5DF2\u751F\u6210\u7684\u4EA7\u7269:
\`\`\`
${e}
\`\`\``,s+=`

\u8BF7\u5BF9\u5176\u8FDB\u884C\u8BC4\u4F30\uFF0C\u5E76\u4EE5\u6307\u5B9A\u7684JSON\u683C\u5F0F\u63D0\u4F9B\u60A8\u7684\u5206\u6570\u548C\u5EFA\u8BAE\u3002`;let n=await this.llmRequest(s,!0);try{let o=JSON.parse(n);if(o&&typeof o.score=="number"&&Array.isArray(o.suggestions))return o;throw new Error("\u6765\u81EA\u8BC4\u4F30\u8005\u7684\u54CD\u5E94\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u8BC4\u4F30\u7ED3\u679C\u3002")}catch(o){let c=n.match(/```json\n([\s\S]*?)\n```/);if(c&&c[1])try{let i=JSON.parse(c[1]);if(i&&typeof i.score=="number"&&Array.isArray(i.suggestions))return i}catch(i){throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BC4\u4F30\u7ED3\u679C\uFF0C\u5373\u4F7F\u5728\u627E\u5230JSON\u5757\u4E4B\u540E\u3002\u9519\u8BEF: ${i.message}`)}throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BC4\u4F30\u7ED3\u679C\u3002\u9519\u8BEF: ${o.message}`)}}};Xe.exports={EvaluatorAgent:oe}});var ce=f((xs,Ze)=>{"use strict";var{BaseAgent:yr}=T(),br=`\u4F60\u662F\u4E00\u4F4D\u201C\u9996\u5E2D\u8BC4\u5BA1\u5458\u201D\u3002\u4F60\u6536\u5230\u4E86\u4E00\u7CFB\u5217\u9488\u5BF9\u67D0\u4E2A\u8F6F\u4EF6\u4EA7\u7269\u7684\u8BC4\u5BA1\u610F\u89C1\uFF0C\u6BCF\u4E00\u6761\u90FD\u6765\u81EA\u4E0D\u540C\u7684AI\u52A9\u624B\u3002\u4F60\u7684\u5DE5\u4F5C\u662F\u5C06\u6240\u6709\u8FD9\u4E9B\u53CD\u9988\u6574\u5408\u6210\u4E00\u4E2A\u5355\u4E00\u3001\u6E05\u6670\u3001\u53EF\u64CD\u4F5C\u7684\u6700\u7EC8\u8BC4\u5BA1\u3002

\u4F60\u5C06\u6536\u5230\u539F\u59CB\u7684\u7528\u6237\u8BF7\u6C42\u548C\u4E00\u7CFB\u5217\u8BC4\u4F30\u7ED3\u679C\uFF0C\u6BCF\u4E2A\u8BC4\u4F30\u90FD\u5305\u542B\u4E00\u4E2A\u5206\u6570\u548C\u4E00\u4E9B\u5EFA\u8BAE\u3002

\u4F60\u7684\u4EFB\u52A1\u662F\uFF1A
1.  **\u6574\u5408\u5EFA\u8BAE\uFF1A** \u5C06\u6240\u6709\u5EFA\u8BAE\u5408\u5E76\u6210\u4E00\u4E2A\u5355\u4E00\u3001\u53BB\u91CD\u4E14\u8FDE\u8D2F\u7684\u6539\u8FDB\u5217\u8868\u3002\u5220\u9664\u5197\u4F59\u7684\u89C2\u70B9\uFF0C\u5408\u5E76\u76F8\u4F3C\u7684\u60F3\u6CD5\u3002
2.  **\u51B3\u5B9A\u6700\u7EC8\u5206\u6570\uFF1A** \u57FA\u4E8E\u6240\u63D0\u4F9B\u7684\u5206\u6570\u548C\u4F60\u5BF9\u53CD\u9988\u7684\u8BC4\u4F30\uFF0C\u786E\u5B9A\u4E00\u4E2A\u6700\u7EC8\u7684\u3001\u5355\u4E00\u7684\u4EA7\u7269\u5206\u6570\u3002\u8FD9\u53EF\u4EE5\u662F\u5E73\u5747\u5206\u3001\u52A0\u6743\u5E73\u5747\u5206\uFF0C\u6216\u8005\u5728\u53CD\u9988\u6307\u51FA\u4E25\u91CD\u95EE\u9898\u65F6\u7684\u6700\u4F4E\u5206\u3002
3.  **\u63D0\u4F9B\u603B\u7ED3\uFF1A** \u64B0\u5199\u4E00\u4E2A\u7B80\u77ED\u3001\u9AD8\u5EA6\u6982\u62EC\u7684\u603B\u4F53\u8BC4\u4F30\u603B\u7ED3\u3002

\u4F60\u5FC5\u987B\u4EE5\u4E00\u4E2A\u5305\u542B\u4E09\u4E2A\u952E\u7684JSON\u5BF9\u8C61\u7684\u5F62\u5F0F\u8F93\u51FA\u4F60\u7684\u6700\u7EC8\u8BC4\u5BA1\uFF1A"score" (\u4E00\u4E2A\u6570\u5B57)\uFF0C"suggestions" (\u4E00\u4E2A\u5B57\u7B26\u4E32\u6570\u7EC4)\uFF0C\u548C "summary" (\u4E00\u4E2A\u5B57\u7B26\u4E32)\u3002

\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u89E3\u91CA\u3002\u53EA\u8F93\u51FAJSON\u5BF9\u8C61\u3002`,ie=class extends yr{constructor(e,t,s,n){let o=br;super(e,t||o,s,n)}async executeTask(e,t){let s=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42\u662F: "${t.originalUserRequest}"`;s+=`

\u8FD9\u662F\u6765\u81EA\u56E2\u961F\u7684\u8BC4\u4F30\u7ED3\u679C:
${JSON.stringify(e,null,2)}`,s+=`

\u8BF7\u5C06\u8FD9\u4E9B\u8BC4\u4F30\u6574\u5408\u6210\u4E00\u4E2A\u5355\u4E00\u7684\u3001\u6700\u7EC8\u7684\u8BC4\u5BA1\uFF0C\u5E76\u4EE5\u6307\u5B9A\u7684JSON\u683C\u5F0F\u8F93\u51FA\u3002`;let n=await this.llmRequest(s,!0);try{let o=JSON.parse(n);if(o&&typeof o.score=="number"&&Array.isArray(o.suggestions)&&typeof o.summary=="string")return o;throw new Error("\u6765\u81EA\u8BC4\u5BA1\u805A\u5408\u8005\u7684\u54CD\u5E94\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u8BC4\u5BA1\u7ED3\u679C\u3002")}catch(o){let c=n.match(/```json\n([\s\S]*?)\n```/);if(c&&c[1])try{let i=JSON.parse(c[1]);if(i&&typeof i.score=="number"&&Array.isArray(i.suggestions)&&typeof i.summary=="string")return i}catch(i){throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BC4\u5BA1\u7ED3\u679C\uFF0C\u5373\u4F7F\u5728\u627E\u5230JSON\u5757\u4E4B\u540E\u3002\u9519\u8BEF: ${i.message}`)}throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u8BC4\u5BA1\u7ED3\u679C\u3002\u9519\u8BEF: ${o.message}`)}}};Ze.exports={CritiqueAggregationAgent:ie}});var le=f((Es,Qe)=>{"use strict";var{BaseAgent:Sr}=T(),vr=`\u4F60\u662F\u4E00\u4E2A\u201C\u4EE3\u7801\u5E93\u626B\u63CF\u5458\u201D\u667A\u80FD\u4F53\u3002\u4F60\u552F\u4E00\u7684\u76EE\u7684\u662F\u8BFB\u53D6\u4E00\u4E2A\u6587\u4EF6\u7684\u6E90\u4EE3\u7801\uFF0C\u5E76\u63D0\u4F9B\u4E00\u4E2A\u5173\u4E8E\u5176\u4E3B\u8981\u529F\u80FD\u6216\u7528\u9014\u7684\u3001\u7B80\u6D01\u7684\u4E00\u53E5\u8BDD\u603B\u7ED3\u3002

\u4E0D\u8981\u9010\u884C\u63CF\u8FF0\u4EE3\u7801\u3002\u4E13\u6CE8\u4E8E\u9AD8\u5C42\u6B21\u7684\u804C\u8D23\u3002
\u4F8B\u5982\uFF0C\u5982\u679C\u4F60\u770B\u5230\u4E00\u4E2A\u8BBE\u7F6EWeb\u670D\u52A1\u5668\u7684\u6587\u4EF6\uFF0C\u4E00\u4E2A\u597D\u7684\u603B\u7ED3\u662F\u201C\u6B64\u6587\u4EF6\u914D\u7F6E\u5E76\u542F\u52A8\u4E00\u4E2AExpress Web\u670D\u52A1\u5668\u3002\u201D
\u5982\u679C\u4E00\u4E2A\u6587\u4EF6\u5BFC\u51FA\u4E86\u4E00\u7EC4\u8F85\u52A9\u51FD\u6570\uFF0C\u4E00\u4E2A\u597D\u7684\u603B\u7ED3\u662F\u201C\u6B64\u6587\u4EF6\u63D0\u4F9B\u7528\u4E8E\u5B57\u7B26\u4E32\u64CD\u4F5C\u548C\u65E5\u671F\u683C\u5F0F\u5316\u7684\u5B9E\u7528\u51FD\u6570\u3002\u201D

\u4F60\u5FC5\u987B\u53EA\u8F93\u51FA\u8FD9\u53E5\u603B\u7ED3\u3002\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u5176\u4ED6\u6587\u672C\u6216\u89E3\u91CA\u3002`,ue=class extends Sr{constructor(e,t,s,n){let o=vr;super(e,t||o,s,n)}async executeTask(e){if(!e||e.trim()==="")return"\u6B64\u6587\u4EF6\u4E3A\u7A7A\u3002";let s=`\u8BF7\u603B\u7ED3\u4EE5\u4E0B\u4EE3\u7801\u6587\u4EF6\u7684\u7528\u9014:

\`\`\`
${e.substring(0,4e3)}
\`\`\``;return(await this.llmRequest(s)).trim()}};Qe.exports={CodebaseScannerAgent:ue}});var pe=f((qs,et)=>{"use strict";var{BaseAgent:$r}=T(),kr=`\u4F60\u662F\u4E00\u4E2A\u201C\u53CD\u601D\u8005\u201D\u667A\u80FD\u4F53\u3002\u4F60\u7684\u5DE5\u4F5C\u662F\u8BCA\u65AD\u53E6\u4E00\u4E2A\u667A\u80FD\u4F53\u6267\u884C\u4EFB\u52A1\u5931\u8D25\u7684\u539F\u56E0\uFF0C\u5E76\u63D0\u51FA\u4E00\u4E2A\u5177\u4F53\u7684\u3001\u4FEE\u6B63\u540E\u7684\u4E0B\u4E00\u6B65\u884C\u52A8\u3002

\u4F60\u5C06\u6536\u5230\u5931\u8D25\u7684\u5B50\u4EFB\u52A1\u63CF\u8FF0\u548C\u5B83\u4EA7\u751F\u7684\u9519\u8BEF\u4FE1\u606F\u3002
\u4F60\u7684\u76EE\u6807\u4E0D\u662F\u53BB\u6267\u884C\u4EFB\u52A1\uFF0C\u800C\u662F\u63D0\u4F9B\u4E00\u4E2A\u6E05\u6670\u7684\u8BCA\u65AD\u548C\u53EF\u884C\u7684\u89E3\u51B3\u65B9\u6848\u3002

\u4F60\u5FC5\u987B\u4EE5\u4E00\u4E2A\u53EA\u5305\u542B "cause" \u548C "nextStep" \u952E\u7684JSON\u5BF9\u8C61\u4F5C\u4E3A\u54CD\u5E94\u3002
- "cause": \u5BF9\u5931\u8D25\u6839\u672C\u539F\u56E0\u7684\u7B80\u8981\u5206\u6790\uFF08\u4F8B\u5982\uFF0C\u201C\u6587\u4EF6\u672A\u627E\u5230\uFF0C\u53EF\u80FD\u662F\u8DEF\u5F84\u9519\u8BEF\u201D\u6216\u201C\u547D\u4EE4\u8BED\u6CD5\u4E0D\u6B63\u786E\u201D\uFF09\u3002
- "nextStep": \u4E00\u4E2A\u5168\u65B0\u7684\u3001\u5B8C\u6574\u7684\u3001\u4FEE\u6B63\u540E\u7684\u5B50\u4EFB\u52A1\u63CF\u8FF0\uFF0C\u4F9B\u201C\u5DE5\u4EBA\u201D\u667A\u80FD\u4F53\u4E0B\u4E00\u6B21\u5C1D\u8BD5\u3002\u8FD9\u4E2A\u63CF\u8FF0\u5E94\u8BE5\u76F4\u63A5\u89E3\u51B3\u4F60\u5206\u6790\u51FA\u7684\u5931\u8D25\u539F\u56E0\u3002

\u4F8B\u5982\uFF0C\u5BF9\u4E8E\u5931\u8D25\u7684\u4EFB\u52A1\u201C\u8BFB\u53D6 'data/user.txt'\u201D\u548C\u9519\u8BEF\u201CError: ENOENT: no such file or directory\u201D\uFF0C\u4E00\u4E2A\u597D\u7684\u54CD\u5E94\u662F\uFF1A
{
  "cause": "\u6587\u4EF6 'data/user.txt' \u672A\u627E\u5230\u3002\u53EF\u80FD\u662F\u8DEF\u5F84\u4E0D\u6B63\u786E\u6216\u6587\u4EF6\u5C1A\u4E0D\u5B58\u5728\u3002",
  "nextStep": "\u5217\u51FA\u6839\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6\u548C\u6587\u4EF6\u5939\uFF0C\u4EE5\u786E\u8BA4 'data/user.txt' \u7684\u6B63\u786E\u8DEF\u5F84\u3002"
}

\u53E6\u4E00\u4E2A\u4F8B\u5B50\uFF0C\u5BF9\u4E8E\u5931\u8D25\u7684\u4EFB\u52A1\u201C\u8FD0\u884C\u547D\u4EE4 'git comit -m "Initial commit"'\u201D\u548C\u9519\u8BEF\u201C'comit' is not a git command\u201D\uFF0C\u4E00\u4E2A\u597D\u7684\u54CD\u5E94\u662F\uFF1A
{
  "cause": "Git\u547D\u4EE4 'comit' \u62FC\u5199\u9519\u8BEF\u3002",
  "nextStep": "\u8FD0\u884C\u547D\u4EE4 'git commit -m "Initial commit"'"
}

\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u989D\u5916\u7684\u89E3\u91CA\u3002\u53EA\u8F93\u51FAJSON\u5BF9\u8C61\u3002`,de=class extends $r{constructor(e,t,s,n){let o=kr;super(e,t||o,s,n)}async executeTask(e){let t=`\u5B50\u4EFB\u52A1\u5931\u8D25\u4E86\u3002

\u539F\u59CB\u4EFB\u52A1\u63CF\u8FF0: "${e.description}"

\u9519\u8BEF\u4FE1\u606F: "${e.error}"

\u8BF7\u5206\u6790\u5931\u8D25\u539F\u56E0\u5E76\u63D0\u4F9B\u4FEE\u6B63\u540E\u7684\u4E0B\u4E00\u6B65\u3002`,s=await this.llmRequest(t,!0);try{let n=JSON.parse(s);if(n&&n.cause&&n.nextStep)return n;throw new Error("\u6765\u81EA\u53CD\u601D\u8005\u7684\u54CD\u5E94\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684JSON\u5BF9\u8C61\u3002")}catch(n){let o=s.match(/```json\n([\s\S]*?)\n```/);if(o&&o[1])try{let c=JSON.parse(o[1]);if(c&&c.cause&&c.nextStep)return c}catch(c){throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u53CD\u601D\u7ED3\u679C\uFF0C\u5373\u4F7F\u5728\u627E\u5230JSON\u5757\u4E4B\u540E\u3002\u9519\u8BEF: ${c.message}`)}throw new Error(`\u65E0\u6CD5\u4ECELLM\u54CD\u5E94\u4E2D\u89E3\u6790\u53CD\u601D\u7ED3\u679C\u3002\u9519\u8BEF: ${n.message}`)}}};et.exports={ReflectorAgent:de}});var me=f((As,tt)=>{"use strict";var{BaseAgent:Pr}=T(),Tr=`You are a "Reviewer" agent. Your role is to be a meticulous and constructive code and plan reviewer. You will be given a proposed action from another agent, such as a code snippet to be written to a file or a shell command to be executed.

Your task is to analyze the proposed action and provide a critical review.
- Is the code correct and efficient?
- Does it follow best practices?
- Are there any potential bugs or edge cases that have been missed?
- Is the shell command safe and will it achieve the intended result?
- Is there a simpler or better way to accomplish the task?

You must respond with a JSON object containing two keys:
- "approved": A boolean value. \`true\` if the action is good and can proceed as is, \`false\` if there are issues.
- "feedback": A string containing your detailed critique and specific, actionable suggestions for improvement if \`approved\` is \`false\`. If \`approved\` is \`true\`, this can be a brief confirmation message.

You do not have access to any tools. Your only function is to review and provide feedback.`,ge=class extends Pr{constructor(e,t,s,n){let o=Tr;super(e,t||o,s,n)}async executeTask(e){let t=`Please review the following proposed action:

\`\`\`
${e}
\`\`\``,s=await this.llmRequest(t,!0);try{let n=JSON.parse(s);if(typeof n.approved=="boolean"&&typeof n.feedback=="string")return n;throw new Error("Reviewer agent response is not a valid review object.")}catch(n){let o=s.match(/```json\n([\s\S]*?)\n```/);if(o&&o[1])try{let c=JSON.parse(o[1]);if(typeof c.approved=="boolean"&&typeof c.feedback=="string")return c}catch(c){throw new Error(`Failed to parse review from LLM response, even after finding JSON block. Error: ${c.message}`)}throw new Error(`Failed to parse review from LLM response. Error: ${n.message}`)}}};tt.exports={ReviewerAgent:ge}});var we=f((Rs,rt)=>{"use strict";var{BaseAgent:xr}=T(),fe=class extends xr{constructor(e,t){super(e,t)}async executeTask(e){let t=this.formatContextForExtraction(e),s=`${this.systemPrompt}

[\u4EFB\u52A1\u5386\u53F2]
${t}

\u8BF7\u6839\u636E\u4EE5\u4E0A\u5386\u53F2\uFF0C\u63D0\u53D6\u51FA3-5\u6761\u6700\u6709\u4EF7\u503C\u3001\u6700\u53EF\u80FD\u88AB\u672A\u6765\u4EFB\u52A1\u590D\u7528\u7684\u7ECF\u9A8C\u6216\u77E5\u8BC6\u70B9\u3002`;try{let n=await this.llm.sendRequest([{role:"user",content:s}]),o="";for await(let c of n.stream)c.textContent&&(o+=c.textContent);return o.split(`
`).map(c=>c.trim()).filter(c=>c.length>0)}catch(n){return console.error("Error extracting knowledge:",n),[]}}formatContextForExtraction(e){let t=`\u539F\u59CB\u7528\u6237\u8BF7\u6C42: ${e.originalUserRequest}

`;return e.history.forEach(s=>{t+=`--- \u7B2C ${s.iteration} \u8F6E ---
`,t+=`\u8BA1\u5212:
`,s.subTasks.forEach(n=>{t+=`- [${n.status}] ${n.description.split(`

`)[0]}
`,n.result&&(t+=`  \u7ED3\u679C: ${JSON.stringify(n.result)}
`),n.error&&(t+=`  \u9519\u8BEF: ${n.error}
`)}),t+=`
\u8BC4\u4F30: ${s.evaluation.score}/10 - ${s.evaluation.summary}
`,t+=`\u4EA7\u7269:
\`\`\`
${s.artifact}
\`\`\`

`}),t}};rt.exports={KnowledgeExtractorAgent:fe}});var he=f((Fs,nt)=>{"use strict";var J=require("fs").promises,Er=require("path"),E;function qr(r){E=Er.join(r.globalStoragePath,"knowledgeBase.json")}async function st(){try{await J.access(E)}catch{await J.writeFile(E,JSON.stringify([],null,2),"utf8")}}async function Ar(r){if(!E)throw new Error("Knowledge base not initialized. Call initialize(context) first.");await st();let e=await J.readFile(E,"utf8"),t=JSON.parse(e);t.includes(r)||(t.push(r),await J.writeFile(E,JSON.stringify(t,null,2),"utf8"))}async function Rr(r,e){if(!E)return"\u77E5\u8BC6\u5E93\u672A\u521D\u59CB\u5316\u3002";await st();let t=await J.readFile(E,"utf8"),s=JSON.parse(t);if(s.length===0)return"\u77E5\u8BC6\u5E93\u4E3A\u7A7A\uFF0C\u65E0\u53EF\u7528\u7ECF\u9A8C\u3002";let n=`\u4F60\u662F\u4E00\u4E2A\u77E5\u8BC6\u68C0\u7D22\u52A9\u624B\u3002\u8BF7\u4ECE\u4EE5\u4E0B\u77E5\u8BC6\u5E93\u6761\u76EE\u4E2D\uFF0C\u9009\u51FA\u4E0E\u7528\u6237\u67E5\u8BE2\u6700\u76F8\u5173\u7684\u6700\u591A5\u6761\u4FE1\u606F\u3002\u53EA\u8FD4\u56DE\u76F8\u5173\u7684\u6761\u76EE\uFF0C\u6BCF\u4E2A\u6761\u76EE\u5360\u4E00\u884C\u3002\u5982\u679C\u627E\u4E0D\u5230\u76F8\u5173\u7684\uFF0C\u5219\u8FD4\u56DE\u7A7A\u5B57\u7B26\u4E32\u3002

[\u77E5\u8BC6\u5E93]
${s.join(`
`)}

[\u7528\u6237\u67E5\u8BE2]
${r}`;try{let o=await e.sendRequest([{role:"user",content:n}]),c="";for await(let i of o.stream)i.textContent&&(c+=i.textContent);return c.trim()?`--- \u4ECE\u77E5\u8BC6\u5E93\u4E2D\u68C0\u7D22\u5230\u7684\u76F8\u5173\u7ECF\u9A8C ---
${c}
--- \u7ED3\u675F ---`:"\u5728\u77E5\u8BC6\u5E93\u4E2D\u672A\u627E\u5230\u76F4\u63A5\u76F8\u5173\u7684\u7ECF\u9A8C\u3002"}catch(o){return console.error("Error querying knowledge base with LLM:",o),"\u67E5\u8BE2\u77E5\u8BC6\u5E93\u65F6\u51FA\u9519\u3002"}}nt.exports={initialize:qr,addKnowledge:Ar,queryKnowledge:Rr}});var at=f((Ms,ot)=>{"use strict";function Fr(r){let e={errors:[],warnings:[],success:[]},t=r.get("models",[]),s=r.get("roles",[]);if(t.length===0)return e.errors.push("\u914D\u7F6E\u9519\u8BEF\uFF1A\u6CA1\u6709\u5B9A\u4E49\u4EFB\u4F55\u6A21\u578B\u3002\u8BF7\u5728\u201C\u8BBE\u7F6E\u201D\u4E2D\u81F3\u5C11\u6DFB\u52A0\u4E00\u4E2A\u6A21\u578B\u3002"),e;e.success.push(`\u68C0\u6D4B\u5230 ${t.length} \u4E2A\u5DF2\u5B9A\u4E49\u7684\u6A21\u578B\u3002`);let n=new Set;t.forEach((a,d)=>{!a.name||!a.provider||!a.modelName||!a.apiKey?e.errors.push(`\u6A21\u578B #${d+1} \u914D\u7F6E\u4E0D\u5B8C\u6574\u3002\u7F3A\u5C11 "name", "provider", "modelName", \u6216 "apiKey" \u5B57\u6BB5\u3002`):e.success.push(`\u6A21\u578B "${a.name}" \u7684\u57FA\u672C\u5B57\u6BB5\u5B8C\u6574\u3002`),a.name&&(n.has(a.name)&&e.errors.push(`\u6A21\u578B\u540D\u79F0\u91CD\u590D: "${a.name}"\u3002\u6A21\u578B\u540D\u79F0\u5FC5\u987B\u662F\u552F\u4E00\u7684\u3002`),n.add(a.name))}),s.length===0?e.warnings.push("\u914D\u7F6E\u8B66\u544A\uFF1A\u6CA1\u6709\u5B9A\u4E49\u4EFB\u4F55\u89D2\u8272\u3002\u63D2\u4EF6\u5C06\u4F7F\u7528\u9ED8\u8BA4\u89D2\u8272\u3002"):e.success.push(`\u68C0\u6D4B\u5230 ${s.length} \u4E2A\u5DF2\u5B9A\u4E49\u7684\u89D2\u8272\u3002`);let o=new Set(["Orchestrator","Worker","Synthesizer","Evaluator","CritiqueAggregator","CodebaseScanner"]),c=new Set(s.map(a=>a.name));s.forEach(a=>{a.model?n.has(a.model)?e.success.push(`\u89D2\u8272 "${a.name}" \u5DF2\u6210\u529F\u94FE\u63A5\u5230\u6A21\u578B "${a.model}"\u3002`):e.errors.push(`\u914D\u7F6E\u9519\u8BEF\uFF1A\u89D2\u8272 "${a.name}" \u5206\u914D\u7684\u6A21\u578B "${a.model}" \u4E0D\u5B58\u5728\u4E8E\u6A21\u578B\u5217\u8868\u4E2D\u3002`):e.warnings.push(`\u89D2\u8272 "${a.name}" \u6CA1\u6709\u5206\u914D\u6A21\u578B\u3002\u5B83\u5C06\u65E0\u6CD5\u5DE5\u4F5C\u3002`)}),o.forEach(a=>{c.has(a)||e.warnings.push(`\u5173\u952E\u89D2\u8272 "${a}" \u672A\u5B9A\u4E49\u3002\u63D2\u4EF6\u529F\u80FD\u53EF\u80FD\u4F1A\u53D7\u9650\u3002`)});let i=s.find(a=>a.name==="Worker");if(i){let a=new Set(i.allowedTools||[]);!a.has("fileSystem.readFile")||!a.has("fileSystem.writeFile")?e.warnings.push("\u201C\u5DE5\u4EBA\u201D\u89D2\u8272\u53EF\u80FD\u7F3A\u5C11\u57FA\u672C\u7684\u6587\u4EF6\u7CFB\u7EDF\u5DE5\u5177\uFF08\u5982 readFile, writeFile\uFF09\uFF0C\u8FD9\u53EF\u80FD\u4F1A\u5F71\u54CD\u5176\u6838\u5FC3\u529F\u80FD\u3002"):e.success.push("\u201C\u5DE5\u4EBA\u201D\u89D2\u8272\u5DF2\u914D\u7F6E\u57FA\u672C\u7684\u6587\u4EF6\u7CFB\u7EDF\u5DE5\u5177\u3002"),a.has("terminal.executeCommand")?e.success.push("\u201C\u5DE5\u4EBA\u201D\u89D2\u8272\u5DF2\u914D\u7F6E\u7EC8\u7AEF\u5DE5\u5177\u3002"):e.warnings.push("\u201C\u5DE5\u4EBA\u201D\u89D2\u8272\u672A\u88AB\u6388\u6743\u4F7F\u7528 `terminal.executeCommand` \u5DE5\u5177\u3002\u7F16\u8BD1\u6216\u8FD0\u884C\u811A\u672C\u7B49\u4EFB\u52A1\u5C06\u65E0\u6CD5\u6267\u884C\u3002")}return e}ot.exports={runHealthCheck:Fr}});var lt=f((Is,ut)=>{"use strict";var A=require("vscode"),{getModelForRole:Mr,getModelsForTeam:Os,getRoleProfile:ct}=O(),Or=_(),{executeTool:Ir}=B(),{OrchestratorAgent:Cr}=ee(),{WorkerAgent:Jr}=re(),{SynthesizerAgent:Lr}=ne(),{EvaluatorAgent:Nr}=ae(),{CritiqueAggregationAgent:Dr}=ce(),{CodebaseScannerAgent:jr}=le(),{ReflectorAgent:Br}=pe(),{ReviewerAgent:Wr}=me(),{KnowledgeExtractorAgent:zr}=we(),{MainPanel:l}=M(),Ur=he();function _r(r,e){let{getModelForRole:t,getModelsForTeam:s,getRoleProfile:n}=O(),o={},i=n("Worker").systemPrompt;r.get("enableAgentCollaboration",!1)&&(i+=`
- 'agent.sendMessage': \u5411\u53E6\u4E00\u4E2A\u667A\u80FD\u4F53\u53D1\u9001\u6D88\u606F\u3002
  - args: { "recipientId": "<\u63A5\u6536\u65B9\u667A\u80FD\u4F53\u7684ID>", "messageContent": "<\u6D88\u606F\u5185\u5BB9>" }`),o.orchestrator=new Cr(t("Orchestrator"),n("Orchestrator").systemPrompt,"Orchestrator",e),o.worker=new Jr(t("Worker"),i,"Worker",e),o.synthesizer=new Lr(t("Synthesizer"),n("Synthesizer").systemPrompt,"Synthesizer",e),o.critiqueAggregator=new Dr(t("CritiqueAggregator"),n("CritiqueAggregator").systemPrompt,"CritiqueAggregator",e),o.scannerAgent=new jr(t("CodebaseScanner"),n("CodebaseScanner").systemPrompt,"CodebaseScanner",e);let a=n("Reflector");o.reflectorAgent=a?new Br(t("Reflector"),a.systemPrompt,"Reflector",e):null;let d=n("Reviewer");return o.reviewerAgent=d?new Wr(t("Reviewer"),d.systemPrompt,"Reviewer",e):null,o.evaluationTeamConfigs=s("Evaluator"),o.evaluatorProfile=n("Evaluator"),o}function Kr(r,e,t){r.on("createSubTask",s=>{if(!t)return;let n=t.subTasks.length>0?Math.max(...t.subTasks.map(a=>a.id))+1:1,o=t.subTasks.find(a=>a.status==="in_progress"),c=o?[o.id]:[],i={id:n,description:`(\u59D4\u6D3E\u81EA ${s.recipientRole}): ${s.taskDescription}`,dependencies:c,status:"pending",result:null,error:null};t.subTasks.push(i),l.update({command:"log",text:`\u52A8\u6001\u521B\u5EFA\u65B0\u4EFB\u52A1 #${n} \u5E76\u5DF2\u6DFB\u52A0\u5230\u8BA1\u5212\u4E2D\u3002`}),l.update({command:"updatePlan",plan:t.subTasks})}),r.on("message",async s=>{if(!(!t||!s.recipientId)){if(s.recipientId==="Reviewer"&&e.reviewerAgent){l.update({command:"log",text:`Reviewer \u6B63\u5728\u5BA1\u67E5\u6765\u81EA ${s.senderId} \u7684\u64CD\u4F5C...`});try{let n=await e.reviewerAgent.executeTask(s.messageContent);r.emit("message",{senderId:"Reviewer",recipientId:s.senderId,isReview:!0,review:n,originalSubTaskId:s.subTaskId})}catch(n){l.update({command:"log",text:`Reviewer Agent \u5931\u8D25: ${n.message}`})}}if(s.senderId==="Reviewer"&&s.isReview){let n=t.subTasks.find(o=>o.id===s.originalSubTaskId);if(n&&n.status==="waiting_for_review"){l.update({command:"log",text:`\u6536\u5230\u5BF9\u4EFB\u52A1 #${n.id} \u7684\u5BA1\u67E5\u53CD\u9988\u3002`});let{approved:o,feedback:c}=s.review;n.description+=`

--- \u5BA1\u67E5\u53CD\u9988 ---
\u72B6\u6001: ${o?"\u5DF2\u6279\u51C6":"\u9700\u8981\u4FEE\u6539"}
\u53CD\u9988: ${c}`,n.status="pending",l.update({command:"updatePlan",plan:t.subTasks})}}}})}async function Yr(r,e,t,s,n){let o=t.get("enableParallelExec",!1);await(async()=>{for(;!r.areAllTasksDone();){let i=r.getRunnableTasks();if(i.length===0){if(r.subTasks.some(d=>d.status==="waiting_for_review")){l.update({command:"log",text:"\u6B63\u5728\u7B49\u5F85\u5BA1\u67E5\u53CD\u9988..."}),await new Promise(d=>setTimeout(d,2e3));continue}l.update({command:"log",text:"\u9519\u8BEF\uFF1A\u68C0\u6D4B\u5230\u4EFB\u52A1\u4F9D\u8D56\u6B7B\u9501\u6216\u6240\u6709\u4EFB\u52A1\u90FD\u5DF2\u5B8C\u6210/\u5931\u8D25\u3002"});break}o?await Promise.all(i.map(a=>it(a,r,e,t,s,n))):await it(i[0],r,e,t,s,n)}})(),l.update({command:"log",text:"\u672C\u8F6E\u6240\u6709\u4EFB\u52A1\u5DF2\u6267\u884C\u5B8C\u6BD5\u3002"})}async function it(r,e,t,s,n,o){e.updateTaskStatus(r.id,"in_progress"),l.update({command:"updatePlan",plan:e.subTasks}),l.update({command:"log",text:`\u6B63\u5728\u6267\u884C\u4EFB\u52A1 ${r.id}: ${r.description.split(`

`)[0]}`});let c=0,i=3,a="";for(;c<i;){let d=await t.worker.executeTask(r,e);try{if(d.toolName==="terminal.executeCommand"&&!s.get("enableAutoMode",!1)&&await A.window.showWarningMessage(`\u667A\u80FD\u4F53\u60F3\u8981\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4: 

${d.args.command}

\u60A8\u662F\u5426\u6279\u51C6?`,{modal:!0},"\u6279\u51C6")!=="\u6279\u51C6")throw new Error("\u7528\u6237\u62D2\u7EDD\u4E86\u7EC8\u7AEF\u547D\u4EE4\u7684\u6267\u884C\u3002");let u={scannerAgent:t.scannerAgent,workerProfile:ct("Worker"),agentMessageBus:n,senderId:t.worker.id,subTaskId:r.id},p=await Ir(d.toolName,d.args,Or,u);if(d.toolName==="agent.sendMessage"&&d.args.recipientId==="Reviewer"){e.updateTaskStatus(r.id,"waiting_for_review"),l.update({command:"log",text:`\u4EFB\u52A1 ${r.id} \u5DF2\u53D1\u9001\u5BA1\u67E5\uFF0C\u6B63\u5728\u7B49\u5F85\u53CD\u9988...`}),l.update({command:"updatePlan",plan:e.subTasks});return}e.updateTaskStatus(r.id,"completed",p),l.update({command:"log",text:`\u4EFB\u52A1 ${r.id} \u6210\u529F\u5B8C\u6210\u3002`}),a="";break}catch(u){if(c++,a=u.message,r.error=a,l.update({command:"log",text:`\u4EFB\u52A1 ${r.id} \u7B2C ${c} \u6B21\u5C1D\u8BD5\u5931\u8D25: ${a}`}),c<i){if(t.reflectorAgent){l.update({command:"log",text:"\u6B63\u5728\u8C03\u7528\u53CD\u601D\u8005\u667A\u80FD\u4F53\u5206\u6790\u5931\u8D25\u539F\u56E0..."});try{let p=await t.reflectorAgent.executeTask(r);l.update({command:"log",text:`\u53CD\u601D\u8005\u5206\u6790\u539F\u56E0: ${p.cause}`}),r.description=p.nextStep}catch(p){l.update({command:"log",text:`\u53CD\u601D\u8005\u667A\u80FD\u4F53\u5931\u8D25: ${p.message}`}),r.description=`${r.description.split(`

`)[0]}

(\u524D\u4E00\u6B21\u5C1D\u8BD5\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F: ${a}). \u8BF7\u5206\u6790\u6B64\u9519\u8BEF\u5E76\u5C1D\u8BD5\u4E0D\u540C\u7684\u65B9\u6CD5\u3002`}}else r.description=`${r.description.split(`

`)[0]}

(\u524D\u4E00\u6B21\u5C1D\u8BD5\u5931\u8D25\uFF0C\u9519\u8BEF\u4FE1\u606F: ${a}). \u8BF7\u5206\u6790\u6B64\u9519\u8BEF\u5E76\u5C1D\u8BD5\u4E0D\u540C\u7684\u65B9\u6CD5\u3002`;l.update({command:"log",text:`\u6B63\u5728\u91CD\u8BD5\u4EFB\u52A1 ${r.id}...`})}}}a&&e.updateTaskStatus(r.id,"failed",`\u5C1D\u8BD5 ${i} \u6B21\u540E\u4EFB\u52A1\u5931\u8D25\u3002\u6700\u540E\u9519\u8BEF: ${a}`),l.update({command:"updatePlan",plan:e.subTasks}),s.get("enablePersistence",!1)&&await o(e)}async function Hr(r,e){return A.workspace.getConfiguration("multiAgent").get("enableAutoMode",!1)?(l.update({command:"log",text:"\u81EA\u52A8\u6A21\u5F0F\u5DF2\u542F\u7528\uFF0C\u81EA\u52A8\u6279\u51C6\u8BA1\u5212\u3002"}),e):(l.update({command:"showPlanForReview",plan:e}),new Promise((t,s)=>{r.once("planApproved",n=>t(n)),r.once("planCancelled",()=>s(new Error("\u4EFB\u52A1\u88AB\u7528\u6237\u53D6\u6D88\u3002")))}))}function Gr(r){let e=`# \u591A\u667A\u80FD\u4F53\u4EFB\u52A1\u62A5\u544A

`;e+=`**\u539F\u59CB\u9700\u6C42:** ${r.originalUserRequest}

`;let t=r.getLatestIteration();t&&(e+=`**\u6700\u7EC8\u5F97\u5206:** ${t.evaluation.score}/10
`,t.evaluation.summary&&(e+=`**\u6700\u7EC8\u603B\u7ED3:** ${t.evaluation.summary}

`),e+=`## \u6700\u7EC8\u4EA7\u7269

\`\`\`
${t.artifact}
\`\`\`

`),e+=`## \u8FED\u4EE3\u5386\u53F2

`;for(let s of r.history)e+=`### \u7B2C ${s.iteration} \u8F6E (\u5F97\u5206: ${s.evaluation.score}/10)
`,s.evaluation.summary&&(e+=`**\u603B\u7ED3:** ${s.evaluation.summary}
`),s.evaluation.suggestions&&s.evaluation.suggestions.length>0&&(e+=`**\u5EFA\u8BAE:**
`+s.evaluation.suggestions.map(n=>`- ${n}`).join(`
`)+`
`),e+=`
`;return e}async function Vr(r,e,t,s,n,o){let{saveTaskState:c,clearTaskState:i}=o,a=t.get("enablePersistence",!1),d=10;for(let u=r.currentIteration-1;u<d;u++){if(l.update({command:"log",text:`--- \u7B2C ${r.currentIteration} \u8F6E\u8FED\u4EE3 ---`}),r.subTasks.every(S=>S.status!=="pending"&&S.status!=="in_progress")){let S=await e.orchestrator.executeTask(r),$=await Hr(n,S);r.setNewPlanForIteration($),l.update({command:"updatePlan",plan:r.subTasks}),a&&await c(r)}await Yr(r,e,t,s,c);let p=await e.synthesizer.executeTask(r);l.update({command:"showArtifact",artifact:p}),l.update({command:"highlightArtifact"});let g=e.evaluationTeamConfigs.map((S,$)=>{let k=`Evaluator_${$+1}`;return new Nr(S,e.evaluatorProfile.systemPrompt,k,s).executeTask(p,r)}),b=await Promise.all(g),m=await e.critiqueAggregator.executeTask(b,r);if(l.update({command:"log",text:`\u6700\u7EC8\u5F97\u5206: ${m.score}/10. \u603B\u7ED3: ${m.summary}`}),r.archiveCurrentIteration(p,m),a&&await c(r),m.score===10){A.window.showInformationMessage("\u4EFB\u52A1\u5DF2\u5B8C\u6210\uFF0C\u8BC4\u5206\u4E3A10/10\uFF01"),a&&await i();break}if(u===d-1){A.window.showWarningMessage("\u5DF2\u8FBE\u5230\u6700\u5927\u8FED\u4EE3\u6B21\u6570\uFF0C\u4EFB\u52A1\u7EC8\u6B62\u3002"),a&&await i();break}if(t.get("enableAutoMode",!1))l.update({command:"log",text:"\u81EA\u52A8\u6A21\u5F0F\u5DF2\u542F\u7528\uFF0C\u81EA\u52A8\u8FDB\u5165\u4E0B\u4E00\u8F6E\u4F18\u5316..."});else if(await A.window.showInformationMessage(`\u7B2C ${r.currentIteration-1} \u8F6E\u5B8C\u6210\uFF0C\u5F97\u5206 ${m.score}/10\u3002
\u603B\u7ED3: ${m.summary}

\u662F\u5426\u7EE7\u7EED\u4F18\u5316?`,{modal:!0},"\u7EE7\u7EED","\u7EC8\u6B62")!=="\u7EE7\u7EED"){a&&await i();break}}}async function Xr(r,e,t,s,n){t.removeAllListeners();let o=_r(e,t);Kr(t,o,r),await Vr(r,o,e,t,s,n);let c=Gr(r),i=await A.workspace.openTextDocument({content:c,language:"markdown"});if(await A.window.showTextDocument(i),e.get("enableLongTermMemory",!1)){l.update({command:"log",text:"\u4EFB\u52A1\u5B8C\u6210\uFF0C\u5F00\u59CB\u63D0\u53D6\u77E5\u8BC6..."});try{let a=ct("KnowledgeExtractor"),u=await new zr(Mr("KnowledgeExtractor"),a.systemPrompt).executeTask(r);if(u&&u.length>0){for(let p of u)await Ur.addKnowledge(p);l.update({command:"log",text:`\u5DF2\u6210\u529F\u63D0\u53D6\u5E76\u4FDD\u5B58 ${u.length} \u6761\u65B0\u77E5\u8BC6\u3002`})}else l.update({command:"log",text:"\u672A\u63D0\u53D6\u5230\u65B0\u7684\u53EF\u6CDB\u5316\u77E5\u8BC6\u3002"})}catch(a){console.error("Failed to extract or save knowledge:",a),l.update({command:"log",text:`\u77E5\u8BC6\u63D0\u53D6\u5931\u8D25: ${a.message}`})}}}ut.exports={runTaskExecution:Xr}});var h=require("vscode"),q=require("fs").promises,z=require("path"),{getModelsForRole:Cs}=O(),dt=_(),{executeTool:Js}=B(),{TaskContext:pt}=ze(),{OrchestratorAgent:Ls}=ee(),{WorkerAgent:Ns}=re(),{SynthesizerAgent:Ds}=ne(),{EvaluatorAgent:js}=ae(),{CritiqueAggregationAgent:Bs}=ce(),{CodebaseScannerAgent:Zr}=le(),{ReflectorAgent:Ws}=pe(),{ReviewerAgent:zs}=me(),{KnowledgeExtractorAgent:Us}=we(),gt=he(),ft=require("events"),{MainPanel:y}=M(),{runHealthCheck:Qr}=at(),{listFiles:es}=Y(),mt=H(),{runTaskExecution:ts}=lt(),rs=new ft,L=null;function ss(){let r=[];return r.push(h.debug.onDidStartDebugSession(e=>{L=e,y.update({command:"log",text:`\u8C03\u8BD5\u4F1A\u8BDD\u5DF2\u5F00\u59CB: ${e.name} (\u7C7B\u578B: ${e.type})`}),y.update({command:"updateDebuggerState",state:{isActive:!0,sessionName:e.name}})})),r.push(h.debug.onDidTerminateDebugSession(e=>{L=null,y.update({command:"log",text:`\u8C03\u8BD5\u4F1A\u8BDD\u5DF2\u7EC8\u6B62: ${e.name}`}),y.update({command:"updateDebuggerState",state:{isActive:!1,sessionName:null}})})),h.debug.activeDebugSession&&(L=h.debug.activeDebugSession,y.update({command:"log",text:`\u68C0\u6D4B\u5230\u5DF2\u6FC0\u6D3B\u7684\u8C03\u8BD5\u4F1A\u8BDD: ${L.name}`}),y.update({command:"updateDebuggerState",state:{isActive:!0,sessionName:L.name}})),r}async function ns(r,e){let t=e?"\u6B63\u5728\u5FEB\u901F\u626B\u63CF\u9879\u76EE\u7ED3\u6784...":"\u6B63\u5728\u6DF1\u5EA6\u626B\u63CF\u9879\u76EE\u4EE3\u7801\u5E93...";y.update({command:"log",text:t});let s=h.workspace.workspaceFolders;if(!s)return"\u6CA1\u6709\u6253\u5F00\u7684\u5DE5\u4F5C\u533A\u3002";let n=s[0].uri.fsPath,o=`\u9879\u76EE\u7ED3\u6784:
`,c=new Set([".git","node_modules","dist","out",".vscode"]),i=new Set([".lock",".svg",".png",".jpg",".jpeg",".gif"]);async function a(d,u=""){let p=await q.readdir(d,{withFileTypes:!0});for(let g of p){if(c.has(g.name))continue;let b=z.join(d,g.name);if(g.isDirectory())o+=`${u}- ${g.name}/
`,await a(b,u+"  ");else{if(i.has(z.extname(g.name)))continue;if(e)o+=`${u}- ${g.name}
`;else try{let m=await q.readFile(b,"utf-8"),S=await r.executeTask(m);o+=`${u}- ${g.name}: ${S}
`}catch{o+=`${u}- ${g.name}: (\u65E0\u6CD5\u8BFB\u53D6\u6216\u603B\u7ED3\u6587\u4EF6)
`}}}}return await a(n),y.update({command:"log",text:"\u9879\u76EE\u626B\u63CF\u5B8C\u6210\u3002"}),o}async function os(r){let e=r.get("roleAssignments");if(e&&Object.keys(e).length>0){y.update({command:"log",text:"\u68C0\u6D4B\u5230\u65E7\u7248\u89D2\u8272\u914D\u7F6E\uFF0C\u6B63\u5728\u8FC1\u79FB..."});let s=r.inspect("roles").defaultValue.map(n=>{let o=n.name.charAt(0).toLowerCase()+n.name.slice(1),c=e[o];return c?{...n,model:c}:n.name==="Evaluator"&&Array.isArray(e.evaluationTeam)&&e.evaluationTeam.length>0?{...n,model:e.evaluationTeam[0]}:n});await r.update("roles",s,h.ConfigurationTarget.Global),await r.update("roleAssignments",void 0,h.ConfigurationTarget.Global),y.update({command:"log",text:"\u914D\u7F6E\u8FC1\u79FB\u5B8C\u6210\u3002"})}}function as(r){let e=ss();r.subscriptions.push(...e),gt.initialize(r),os(h.workspace.getConfiguration("multiAgent"));let t=z.join(r.globalStoragePath,"activeTaskState.json");async function s(u){try{let p=JSON.stringify(u,null,2);await q.mkdir(r.globalStoragePath,{recursive:!0}),await q.writeFile(t,p,"utf8")}catch(p){console.error("Failed to save task state:",p),h.window.showErrorMessage("\u65E0\u6CD5\u4FDD\u5B58\u4EFB\u52A1\u72B6\u6001\u3002")}}async function n(){try{if(q.existsSync(t)){let u=await q.readFile(t,"utf8"),p=JSON.parse(u),g=new pt(p.originalUserRequest);return Object.assign(g,p),g}}catch(u){console.error("Failed to load task state:",u),h.window.showErrorMessage("\u65E0\u6CD5\u52A0\u8F7D\u4EFB\u52A1\u72B6\u6001\u3002")}return null}async function o(){try{q.existsSync(t)&&await q.unlink(t)}catch(u){console.error("Failed to clear task state:",u)}}let c="multiAgentHelper.hasBeenActivated";r.globalState.get(c)||(h.window.showInformationMessage("\u6B22\u8FCE\u4F7F\u7528\u591A\u667A\u80FD\u4F53\u52A9\u624B\uFF01\u8BF7\u5728\u8BBE\u7F6E\u4E2D\u914D\u7F6E\u60A8\u7684AI\u6A21\u578B\u4EE5\u5F00\u59CB\u4F7F\u7528\u3002"),r.globalState.update(c,!0));let i=new ft;i.on("runHealthCheck",()=>{let u=h.workspace.getConfiguration("multiAgent"),p=Qr(u);y.update({command:"healthCheckResult",results:p})}),i.on("getWorkspaceStatus",async()=>{let u=await a();y.update({command:"updateWorkspaceStatus",status:u})});async function a(){try{let u=await es("."),p=h.debug.breakpoints.map(m=>m instanceof h.SourceBreakpoint?`${z.basename(m.location.uri.fsPath)}:${m.location.range.start.line+1}`:"Function Breakpoint"),g=await mt.getCurrentBranch(),b=await mt.getStatus();return{fileSystem:u,breakpoints:p,git:{branch:g.replace("Current branch is: ",""),files:b}}}catch(u){return console.error("Error getting workspace status:",u),{error:u.message}}}let d=h.commands.registerCommand("multi-agent-helper.startTask",async()=>{try{dt.createLogChannel(),y.createOrShow(r,i);let u=h.workspace.getConfiguration("multiAgent"),p=u.get("enablePersistence",!1),g=null;if(p){let b=await n();b&&(await h.window.showInformationMessage("\u68C0\u6D4B\u5230\u6709\u672A\u5B8C\u6210\u7684\u4EFB\u52A1\u3002\u60A8\u60F3\u7EE7\u7EED\u5417?",{modal:!0},"\u7EE7\u7EED\u4E0A\u6B21\u4EFB\u52A1","\u5F00\u59CB\u65B0\u4EFB\u52A1")==="\u7EE7\u7EED\u4E0A\u6B21\u4EFB\u52A1"?(g=b,y.update({command:"log",text:"\u5DF2\u6062\u590D\u4E0A\u6B21\u7684\u4EFB\u52A1\u72B6\u6001\u3002"}),y.update({command:"updateGoal",text:g.originalUserRequest}),y.update({command:"updatePlan",plan:g.subTasks})):await o())}if(!g){let b=await h.window.showInputBox({prompt:"\u8BF7\u8F93\u5165\u60A8\u7684\u603B\u4F53\u4EFB\u52A1\u76EE\u6807"});if(!b){y.update({command:"log",text:"\u4EFB\u52A1\u88AB\u7528\u6237\u53D6\u6D88\u3002"});return}y.update({command:"updateGoal",text:b}),g=new pt(b);let m=u.get("enableLongTermMemory",!1),{getModelForRole:S,getRoleProfile:$}=O();if(m){y.update({command:"log",text:"\u957F\u671F\u8BB0\u5FC6\u5DF2\u542F\u7528\uFF0C\u6B63\u5728\u67E5\u8BE2\u77E5\u8BC6\u5E93..."});let N=await gt.queryKnowledge(b,S("KnowledgeExtractor"));g.addRelevantKnowledge(N),y.update({command:"log",text:"\u77E5\u8BC6\u5E93\u67E5\u8BE2\u5B8C\u6BD5\u3002"})}let k=u.get("enableSmartScan",!1),R=$("CodebaseScanner");if(!R||!R.model){h.window.showErrorMessage("\u4EE3\u7801\u5E93\u626B\u63CF\u5458(CodebaseScanner)\u89D2\u8272\u6216\u5176\u6A21\u578B\u672A\u914D\u7F6E\u3002");return}let F=new Zr(S("CodebaseScanner"),R.systemPrompt);g.projectContext=await ns(F,k)}await ts(g,u,rs,i,{saveTaskState:s,clearTaskState:o})}catch(u){h.window.showErrorMessage(`\u53D1\u751F\u4E25\u91CD\u9519\u8BEF: ${u.message}`),dt.logLine(`
--- \u53D1\u751F\u4E25\u91CD\u9519\u8BEF ---
${u.stack}`)}});r.subscriptions.push(d)}function is(){}module.exports={activate:as,deactivate:is};
